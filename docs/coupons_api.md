# وثائق واجهة برمجة التطبيقات (API) لنظام الكوبونات

## نظرة عامة

يوفر نظام الكوبونات واجهة برمجة تطبيقات RESTful تسمح للمشرفين بإنشاء وإدارة الكوبونات، وللمستخدمين بالتحقق من صلاحية الكوبونات واستخدامها في الطلبات.

## المصادقة

جميع طلبات API تتطلب مصادقة باستخدام Laravel Sanctum. يجب تضمين رمز الوصول (Access Token) في رأس الطلب:

```
Authorization: Bearer {your-token}
```

## نقاط النهاية (Endpoints)

### 1. التحقق من صلاحية الكوبون (للمستخدمين)

يتحقق من صلاحية الكوبون ويحسب قيمة الخصم بناءً على المبلغ الإجمالي.

- **URL**: `/api/coupons/validate`
- **Method**: `POST`
- **المصادقة**: مطلوبة
- **المعلمات**:

  | المعلمة | النوع | الوصف | مطلوب |
  |---------|------|-------------|----------|
  | coupon_code | نص | رمز الكوبون | نعم |
  | subtotal | رقم | المبلغ الإجمالي للطلب | نعم |

- **مثال للطلب**:
  ```json
  {
    "coupon_code": "SUMMER2023",
    "subtotal": 150.00
  }
  ```

- **الاستجابة الناجحة**: `200 OK`
  ```json
  {
    "status": "success",
    "message": "الكوبون صالح",
    "data": {
      "coupon": {
        "id": 1,
        "code": "SUMMER2023",
        "type": "percentage",
        "value": 10.00,
        "min_order_amount": 100.00,
        "max_uses": 100,
        "used_times": 5,
        "start_date": "2023-06-01",
        "end_date": "2023-08-31",
        "is_active": true,
        "created_at": "2023-06-01T10:00:00.000000Z",
        "updated_at": "2023-06-15T12:34:56.000000Z"
      },
      "discount_amount": 15.00,
      "total_after_discount": 135.00
    }
  }
  ```

- **الاستجابات الخاطئة**:
  - `400 Bad Request`: الكوبون غير صالح
  - `422 Unprocessable Entity`: بيانات غير صالحة

### 2. الحصول على قائمة الكوبونات (للمشرف)

يعرض قائمة بجميع الكوبونات في النظام.

- **URL**: `/api/admin/coupons`
- **Method**: `GET`
- **المصادقة**: مطلوبة (المشرف فقط)
- **المعلمات**:

  | المعلمة | النوع | الوصف | مطلوب |
  |---------|------|-------------|----------|
  | page | رقم | رقم الصفحة (الافتراضي: 1) | لا |

- **الاستجابة الناجحة**: `200 OK`
  ```json
  {
    "status": "success",
    "message": "تم الحصول على قائمة الكوبونات بنجاح",
    "data": {
      "current_page": 1,
      "data": [
        {
          "id": 1,
          "code": "SUMMER2023",
          "type": "percentage",
          "value": 10.00,
          "min_order_amount": 100.00,
          "max_uses": 100,
          "used_times": 5,
          "start_date": "2023-06-01",
          "end_date": "2023-08-31",
          "is_active": true,
          "created_at": "2023-06-01T10:00:00.000000Z",
          "updated_at": "2023-06-15T12:34:56.000000Z"
        }
      ],
      "first_page_url": "http://example.com/api/admin/coupons?page=1",
      "from": 1,
      "last_page": 1,
      "last_page_url": "http://example.com/api/admin/coupons?page=1",
      "links": [
        {
          "url": null,
          "label": "&laquo; السابق",
          "active": false
        },
        {
          "url": "http://example.com/api/admin/coupons?page=1",
          "label": "1",
          "active": true
        },
        {
          "url": null,
          "label": "التالي &raquo;",
          "active": false
        }
      ],
      "next_page_url": null,
      "path": "http://example.com/api/admin/coupons",
      "per_page": 10,
      "prev_page_url": null,
      "to": 1,
      "total": 1
    }
  }
  ```

### 3. إنشاء كوبون جديد (للمشرف)

ينشئ كوبونًا جديدًا في النظام.

- **URL**: `/api/admin/coupons`
- **Method**: `POST`
- **المصادقة**: مطلوبة (المشرف فقط)
- **المعلمات**:

  | المعلمة | النوع | الوصف | مطلوب |
  |---------|------|-------------|----------|
  | code | نص | رمز الكوبون (فريد) | نعم |
  | type | نص | نوع الكوبون (percentage, fixed) | نعم |
  | value | رقم | قيمة الخصم (نسبة مئوية أو قيمة ثابتة) | نعم |
  | min_order_amount | رقم | الحد الأدنى لقيمة الطلب | لا |
  | max_uses | رقم | الحد الأقصى لعدد مرات الاستخدام | لا |
  | start_date | تاريخ | تاريخ بدء صلاحية الكوبون | لا |
  | end_date | تاريخ | تاريخ انتهاء صلاحية الكوبون | لا |
  | is_active | منطقي | حالة تنشيط الكوبون | لا |

- **مثال للطلب**:
  ```json
  {
    "code": "SUMMER2023",
    "type": "percentage",
    "value": 10.00,
    "min_order_amount": 100.00,
    "max_uses": 100,
    "start_date": "2023-06-01",
    "end_date": "2023-08-31",
    "is_active": true
  }
  ```

- **الاستجابة الناجحة**: `201 Created`
  ```json
  {
    "status": "success",
    "message": "تم إنشاء الكوبون بنجاح",
    "data": {
      "id": 1,
      "code": "SUMMER2023",
      "type": "percentage",
      "value": 10.00,
      "min_order_amount": 100.00,
      "max_uses": 100,
      "used_times": 0,
      "start_date": "2023-06-01",
      "end_date": "2023-08-31",
      "is_active": true,
      "created_at": "2023-06-15T12:34:56.000000Z",
      "updated_at": "2023-06-15T12:34:56.000000Z"
    }
  }
  ```

- **الاستجابات الخاطئة**:
  - `422 Unprocessable Entity`: بيانات غير صالحة
  - `403 Forbidden`: المستخدم ليس مشرفًا

### 4. عرض تفاصيل كوبون محدد (للمشرف)

يعرض تفاصيل كوبون محدد.

- **URL**: `/api/admin/coupons/{id}`
- **Method**: `GET`
- **المصادقة**: مطلوبة (المشرف فقط)
- **معلمات المسار**:

  | المعلمة | الوصف | مطلوب |
  |---------|-------------|----------|
  | id | معرف الكوبون | نعم |

- **الاستجابة الناجحة**: `200 OK`
  ```json
  {
    "status": "success",
    "message": "تم الحصول على تفاصيل الكوبون بنجاح",
    "data": {
      "id": 1,
      "code": "SUMMER2023",
      "type": "percentage",
      "value": 10.00,
      "min_order_amount": 100.00,
      "max_uses": 100,
      "used_times": 5,
      "start_date": "2023-06-01",
      "end_date": "2023-08-31",
      "is_active": true,
      "created_at": "2023-06-01T10:00:00.000000Z",
      "updated_at": "2023-06-15T12:34:56.000000Z"
    }
  }
  ```

- **الاستجابات الخاطئة**:
  - `404 Not Found`: الكوبون غير موجود
  - `403 Forbidden`: المستخدم ليس مشرفًا

### 5. تحديث كوبون محدد (للمشرف)

يقوم بتحديث بيانات كوبون محدد.

- **URL**: `/api/admin/coupons/{id}`
- **Method**: `PUT`
- **المصادقة**: مطلوبة (المشرف فقط)
- **معلمات المسار**:

  | المعلمة | الوصف | مطلوب |
  |---------|-------------|----------|
  | id | معرف الكوبون | نعم |

- **المعلمات**:

  | المعلمة | النوع | الوصف | مطلوب |
  |---------|------|-------------|----------|
  | code | نص | رمز الكوبون (فريد) | لا |
  | type | نص | نوع الكوبون (percentage, fixed) | لا |
  | value | رقم | قيمة الخصم (نسبة مئوية أو قيمة ثابتة) | لا |
  | min_order_amount | رقم | الحد الأدنى لقيمة الطلب | لا |
  | max_uses | رقم | الحد الأقصى لعدد مرات الاستخدام | لا |
  | start_date | تاريخ | تاريخ بدء صلاحية الكوبون | لا |
  | end_date | تاريخ | تاريخ انتهاء صلاحية الكوبون | لا |
  | is_active | منطقي | حالة تنشيط الكوبون | لا |

- **مثال للطلب**:
  ```json
  {
    "value": 15.00,
    "max_uses": 200,
    "end_date": "2023-09-30"
  }
  ```

- **الاستجابة الناجحة**: `200 OK`
  ```json
  {
    "status": "success",
    "message": "تم تحديث الكوبون بنجاح",
    "data": {
      "id": 1,
      "code": "SUMMER2023",
      "type": "percentage",
      "value": 15.00,
      "min_order_amount": 100.00,
      "max_uses": 200,
      "used_times": 5,
      "start_date": "2023-06-01",
      "end_date": "2023-09-30",
      "is_active": true,
      "created_at": "2023-06-01T10:00:00.000000Z",
      "updated_at": "2023-06-15T13:45:00.000000Z"
    }
  }
  ```

- **الاستجابات الخاطئة**:
  - `422 Unprocessable Entity`: بيانات غير صالحة
  - `404 Not Found`: الكوبون غير موجود
  - `403 Forbidden`: المستخدم ليس مشرفًا

### 6. حذف كوبون محدد (للمشرف)

يقوم بحذف كوبون محدد من النظام.

- **URL**: `/api/admin/coupons/{id}`
- **Method**: `DELETE`
- **المصادقة**: مطلوبة (المشرف فقط)
- **معلمات المسار**:

  | المعلمة | الوصف | مطلوب |
  |---------|-------------|----------|
  | id | معرف الكوبون | نعم |

- **الاستجابة الناجحة**: `200 OK`
  ```json
  {
    "status": "success",
    "message": "تم حذف الكوبون بنجاح"
  }
  ```

- **الاستجابات الخاطئة**:
  - `404 Not Found`: الكوبون غير موجود
  - `403 Forbidden`: المستخدم ليس مشرفًا

## أنواع الكوبونات

- **percentage**: خصم بنسبة مئوية من إجمالي الطلب
- **fixed**: خصم بقيمة ثابتة من إجمالي الطلب

## استخدام الكوبونات في الطلبات

لاستخدام كوبون في طلب جديد، قم بتضمين معلمة `coupon_code` في طلب إنشاء الطلب:

```json
{
  "products": [
    {
      "product_id": 1,
      "quantity": 2
    },
    {
      "product_id": 3,
      "quantity": 1
    }
  ],
  "coupon_code": "SUMMER2023"
}
```

سيقوم النظام تلقائيًا بالتحقق من صلاحية الكوبون وتطبيق الخصم المناسب على الطلب. 