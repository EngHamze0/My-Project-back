# توثيق واجهة برمجة التطبيقات للخدمات والاشتراكات

هذا المستند يشرح تفاصيل استخدام واجهة برمجة التطبيقات (API) المتعلقة بالخدمات والاشتراكات في التطبيق.

## جدول المحتويات

1. [نظرة عامة](#نظرة-عامة)
2. [الخدمات](#الخدمات)
   - [عرض جميع الخدمات](#عرض-جميع-الخدمات)
   - [عرض تفاصيل خدمة معينة](#عرض-تفاصيل-خدمة-معينة)
   - [إنشاء خدمة جديدة](#إنشاء-خدمة-جديدة)
   - [تعديل خدمة](#تعديل-خدمة)
   - [حذف خدمة](#حذف-خدمة)
   - [تغيير حالة خدمة](#تغيير-حالة-خدمة)
   - [عرض المشتركين في خدمة](#عرض-المشتركين-في-خدمة)
3. [الاشتراكات](#الاشتراكات)
   - [اشتراك المستخدم في خدمة](#اشتراك-المستخدم-في-خدمة)
   - [عرض اشتراكات المستخدم الحالي](#عرض-اشتراكات-المستخدم-الحالي)
   - [عرض تفاصيل اشتراك معين](#عرض-تفاصيل-اشتراك-معين)
   - [إلغاء اشتراك](#إلغاء-اشتراك)
   - [عرض جميع الاشتراكات (للمشرفين)](#عرض-جميع-الاشتراكات-للمشرفين)
   - [إنشاء اشتراك جديد (للمشرفين)](#إنشاء-اشتراك-جديد-للمشرفين)
   - [تعديل اشتراك (للمشرفين)](#تعديل-اشتراك-للمشرفين)
   - [تجديد اشتراك (للمشرفين)](#تجديد-اشتراك-للمشرفين)

## نظرة عامة

تسمح واجهة برمجة التطبيقات للخدمات والاشتراكات للمستخدمين بالتالي:

- للمستخدمين المسجلين: عرض الخدمات المتاحة، الاشتراك في الخدمات، عرض وإلغاء الاشتراكات.
- للمشرفين: إدارة الخدمات (إنشاء، تعديل، حذف، تفعيل/تعطيل)، وإدارة الاشتراكات.

تستخدم جميع نقاط النهاية التنسيق JSON لطلبات واستجابات API.

---

## الخدمات

### عرض جميع الخدمات

عرض قائمة الخدمات المتاحة. للمستخدمين العاديين، سيتم عرض الخدمات النشطة فقط. أما المشرفين فسيرون جميع الخدمات.

```
GET /api/services
```

#### الاستجابة

```json
{
    "status": "success",
    "data": [
        {
            "id": 1,
            "name": "صيانة سنوية",
            "description": "خدمة صيانة سنوية شاملة",
            "price": "1000.00",
            "duration_days": 365,
            "is_active": true,
            "created_at": "2023-08-01T12:00:00.000000Z",
            "updated_at": "2023-08-01T12:00:00.000000Z"
        },
        {
            "id": 2,
            "name": "دعم فني شهري",
            "description": "خدمة دعم فني على مدار الشهر",
            "price": "150.00",
            "duration_days": 30,
            "is_active": true,
            "created_at": "2023-08-01T12:30:00.000000Z",
            "updated_at": "2023-08-01T12:30:00.000000Z"
        }
    ]
}
```

### عرض تفاصيل خدمة معينة

عرض تفاصيل خدمة محددة بواسطة المعرف الخاص بها.

```
GET /api/services/{id}
```

#### الاستجابة

```json
{
    "status": "success",
    "data": {
        "id": 1,
        "name": "صيانة سنوية",
        "description": "خدمة صيانة سنوية شاملة",
        "price": "1000.00",
        "duration_days": 365,
        "is_active": true,
        "created_at": "2023-08-01T12:00:00.000000Z",
        "updated_at": "2023-08-01T12:00:00.000000Z"
    }
}
```

### إنشاء خدمة جديدة

إنشاء خدمة جديدة (للمشرفين فقط).

```
POST /api/services
```

#### المعلمات

| المعلمة | النوع | الوصف | المطلوب |
|---------|------|-------------|----------|
| name | string | اسم الخدمة | نعم |
| description | string | وصف الخدمة | نعم |
| price | numeric | سعر الخدمة | نعم |
| duration_days | integer | مدة الخدمة بالأيام | لا (الافتراضي: 365) |
| is_active | boolean | ما إذا كانت الخدمة نشطة | لا (الافتراضي: true) |

#### الاستجابة

```json
{
    "status": "success",
    "message": "تم إنشاء الخدمة بنجاح",
    "data": {
        "id": 3,
        "name": "تدريب تقني",
        "description": "تدريب على استخدام النظام",
        "price": "500.00",
        "duration_days": 90,
        "is_active": true,
        "created_at": "2023-08-05T09:15:00.000000Z",
        "updated_at": "2023-08-05T09:15:00.000000Z"
    }
}
```

### تعديل خدمة

تعديل خدمة موجودة (للمشرفين فقط).

```
POST /api/services/{id}
```

#### المعلمات

| المعلمة | النوع | الوصف | المطلوب |
|---------|------|-------------|----------|
| name | string | اسم الخدمة | لا |
| description | string | وصف الخدمة | لا |
| price | numeric | سعر الخدمة | لا |
| duration_days | integer | مدة الخدمة بالأيام | لا |
| is_active | boolean | ما إذا كانت الخدمة نشطة | لا |

#### الاستجابة

```json
{
    "status": "success",
    "message": "تم تحديث الخدمة بنجاح",
    "data": {
        "id": 3,
        "name": "تدريب تقني متقدم",
        "description": "تدريب متقدم على استخدام النظام",
        "price": "600.00",
        "duration_days": 90,
        "is_active": true,
        "created_at": "2023-08-05T09:15:00.000000Z",
        "updated_at": "2023-08-05T10:20:00.000000Z"
    }
}
```

### حذف خدمة

حذف خدمة محددة (للمشرفين فقط). لا يمكن حذف الخدمات التي لديها اشتراكات نشطة.

```
DELETE /api/services/{id}
```

#### الاستجابة

```json
{
    "status": "success",
    "message": "تم حذف الخدمة بنجاح"
}
```

### تغيير حالة خدمة

تغيير حالة خدمة من نشطة إلى غير نشطة أو العكس (للمشرفين فقط).

```
GET /api/services/toggle-status/{id}
```

#### الاستجابة

```json
{
    "status": "success",
    "message": "تم تغيير حالة الخدمة بنجاح",
    "data": {
        "id": 2,
        "name": "دعم فني شهري",
        "description": "خدمة دعم فني على مدار الشهر",
        "price": "150.00",
        "duration_days": 30,
        "is_active": false,
        "created_at": "2023-08-01T12:30:00.000000Z",
        "updated_at": "2023-08-05T11:45:00.000000Z"
    }
}
```

### عرض المشتركين في خدمة

عرض قائمة المستخدمين المشتركين في خدمة معينة (للمشرفين فقط).

```
GET /api/services/{id}/subscribers
```

#### الاستجابة

```json
{
    "status": "success",
    "data": [
        {
            "subscription_id": 1,
            "user": {
                "id": 5,
                "name": "أحمد محمد",
                "email": "ahmed@example.com",
                "role": "user",
                "phone": "0501234567",
                "is_active": true,
                "created_at": "2023-07-15T10:00:00.000000Z",
                "updated_at": "2023-07-15T10:00:00.000000Z"
            },
            "start_date": "2023-08-02",
            "end_date": "2024-08-01",
            "status": "active",
            "amount_paid": "1000.00"
        },
        {
            "subscription_id": 3,
            "user": {
                "id": 8,
                "name": "سارة علي",
                "email": "sara@example.com",
                "role": "user",
                "phone": "0557891234",
                "is_active": true,
                "created_at": "2023-07-20T14:30:00.000000Z",
                "updated_at": "2023-07-20T14:30:00.000000Z"
            },
            "start_date": "2023-08-05",
            "end_date": "2024-08-04",
            "status": "active",
            "amount_paid": "1000.00"
        }
    ]
}
```

---

## الاشتراكات

### اشتراك المستخدم في خدمة

يسمح للمستخدم المسجل بالاشتراك مباشرة في خدمة متاحة.

```
POST /api/subscribe
```

#### المعلمات

| المعلمة | النوع | الوصف | المطلوب |
|---------|------|-------------|----------|
| service_id | integer | معرف الخدمة المراد الاشتراك بها | نعم |
| payment_details | string | تفاصيل الدفع أو ملاحظات إضافية | لا |

#### الاستجابة

```json
{
    "status": "success",
    "message": "تم الاشتراك في الخدمة بنجاح",
    "data": {
        "id": 5,
        "user_id": 6,
        "service_id": 1,
        "start_date": "2023-08-06",
        "end_date": "2024-08-05",
        "amount_paid": "1000.00",
        "status": "active",
        "notes": "اشتراك مباشر من المستخدم. تم الدفع عبر التحويل البنكي",
        "created_at": "2023-08-06T08:30:00.000000Z",
        "updated_at": "2023-08-06T08:30:00.000000Z",
        "service": {
            "id": 1,
            "name": "صيانة سنوية",
            "description": "خدمة صيانة سنوية شاملة",
            "price": "1000.00",
            "duration_days": 365,
            "is_active": true,
            "created_at": "2023-08-01T12:00:00.000000Z",
            "updated_at": "2023-08-01T12:00:00.000000Z"
        }
    }
}
```

### عرض اشتراكات المستخدم الحالي

عرض قائمة الاشتراكات للمستخدم المسجل حالياً.

```
GET /api/my-subscriptions
```

#### الاستجابة

```json
{
    "status": "success",
    "data": [
        {
            "id": 5,
            "user_id": 6,
            "service_id": 1,
            "start_date": "2023-08-06",
            "end_date": "2024-08-05",
            "amount_paid": "1000.00",
            "status": "active",
            "notes": "اشتراك مباشر من المستخدم. تم الدفع عبر التحويل البنكي",
            "created_at": "2023-08-06T08:30:00.000000Z",
            "updated_at": "2023-08-06T08:30:00.000000Z",
            "service": {
                "id": 1,
                "name": "صيانة سنوية",
                "description": "خدمة صيانة سنوية شاملة",
                "price": "1000.00",
                "duration_days": 365,
                "is_active": true,
                "created_at": "2023-08-01T12:00:00.000000Z",
                "updated_at": "2023-08-01T12:00:00.000000Z"
            }
        }
    ]
}
```

### عرض تفاصيل اشتراك معين

عرض تفاصيل اشتراك محدد. يمكن للمستخدم رؤية اشتراكاته فقط، بينما يمكن للمشرف رؤية جميع الاشتراكات.

```
GET /api/subscriptions/{id}
```

#### الاستجابة

```json
{
    "status": "success",
    "data": {
        "id": 5,
        "user_id": 6,
        "service_id": 1,
        "start_date": "2023-08-06",
        "end_date": "2024-08-05",
        "amount_paid": "1000.00",
        "status": "active",
        "notes": "اشتراك مباشر من المستخدم. تم الدفع عبر التحويل البنكي",
        "created_at": "2023-08-06T08:30:00.000000Z",
        "updated_at": "2023-08-06T08:30:00.000000Z",
        "service": {
            "id": 1,
            "name": "صيانة سنوية",
            "description": "خدمة صيانة سنوية شاملة",
            "price": "1000.00",
            "duration_days": 365,
            "is_active": true,
            "created_at": "2023-08-01T12:00:00.000000Z",
            "updated_at": "2023-08-01T12:00:00.000000Z"
        },
        "user": {
            "id": 6,
            "name": "محمد أحمد",
            "email": "mohammed@example.com",
            "role": "user",
            "phone": "0512345678",
            "is_active": true,
            "created_at": "2023-07-18T11:20:00.000000Z",
            "updated_at": "2023-07-18T11:20:00.000000Z"
        }
    }
}
```

### إلغاء اشتراك

إلغاء اشتراك محدد. يمكن للمستخدم إلغاء اشتراكاته فقط، بينما يمكن للمشرف إلغاء أي اشتراك.

```
POST /api/subscriptions/{id}/cancel
```

#### الاستجابة

```json
{
    "status": "success",
    "message": "تم إلغاء الاشتراك بنجاح",
    "data": {
        "id": 5,
        "user_id": 6,
        "service_id": 1,
        "start_date": "2023-08-06",
        "end_date": "2024-08-05",
        "amount_paid": "1000.00",
        "status": "cancelled",
        "notes": "اشتراك مباشر من المستخدم. تم الدفع عبر التحويل البنكي",
        "created_at": "2023-08-06T08:30:00.000000Z",
        "updated_at": "2023-08-06T09:45:00.000000Z"
    }
}
```

### عرض جميع الاشتراكات (للمشرفين)

عرض جميع الاشتراكات أو اشتراكات مستخدم معين (للمشرفين فقط).

```
GET /api/subscriptions
```

#### المعلمات (اختيارية)

| المعلمة | النوع | الوصف |
|---------|------|-------------|
| user_id | integer | عرض اشتراكات مستخدم معين |

#### الاستجابة

```json
{
    "status": "success",
    "data": [
        {
            "id": 1,
            "user_id": 5,
            "service_id": 1,
            "start_date": "2023-08-02",
            "end_date": "2024-08-01",
            "amount_paid": "1000.00",
            "status": "active",
            "notes": null,
            "created_at": "2023-08-02T10:15:00.000000Z",
            "updated_at": "2023-08-02T10:15:00.000000Z",
            "service": {
                "id": 1,
                "name": "صيانة سنوية",
                "description": "خدمة صيانة سنوية شاملة",
                "price": "1000.00",
                "duration_days": 365,
                "is_active": true,
                "created_at": "2023-08-01T12:00:00.000000Z",
                "updated_at": "2023-08-01T12:00:00.000000Z"
            },
            "user": {
                "id": 5,
                "name": "أحمد محمد",
                "email": "ahmed@example.com",
                "role": "user",
                "phone": "0501234567",
                "is_active": true,
                "created_at": "2023-07-15T10:00:00.000000Z",
                "updated_at": "2023-07-15T10:00:00.000000Z"
            }
        },
        // المزيد من الاشتراكات...
    ]
}
```

### إنشاء اشتراك جديد (للمشرفين)

إنشاء اشتراك جديد لمستخدم (للمشرفين فقط).

```
POST /api/subscriptions
```

#### المعلمات

| المعلمة | النوع | الوصف | المطلوب |
|---------|------|-------------|----------|
| user_id | integer | معرف المستخدم | نعم |
| service_id | integer | معرف الخدمة | نعم |
| start_date | date | تاريخ بدء الاشتراك | لا (الافتراضي: اليوم) |
| amount_paid | numeric | المبلغ المدفوع | نعم |
| notes | string | ملاحظات إضافية | لا |

#### الاستجابة

```json
{
    "status": "success",
    "message": "تم إنشاء الاشتراك بنجاح",
    "data": {
        "id": 6,
        "user_id": 9,
        "service_id": 2,
        "start_date": "2023-08-10",
        "end_date": "2023-09-09",
        "amount_paid": "150.00",
        "status": "active",
        "notes": "تم إنشاء الاشتراك من قبل المشرف",
        "created_at": "2023-08-10T11:00:00.000000Z",
        "updated_at": "2023-08-10T11:00:00.000000Z",
        "service": {
            "id": 2,
            "name": "دعم فني شهري",
            "description": "خدمة دعم فني على مدار الشهر",
            "price": "150.00",
            "duration_days": 30,
            "is_active": true,
            "created_at": "2023-08-01T12:30:00.000000Z",
            "updated_at": "2023-08-01T12:30:00.000000Z"
        },
        "user": {
            "id": 9,
            "name": "فاطمة خالد",
            "email": "fatima@example.com",
            "role": "user",
            "phone": "0523456789",
            "is_active": true,
            "created_at": "2023-07-25T09:10:00.000000Z",
            "updated_at": "2023-07-25T09:10:00.000000Z"
        }
    }
}
```

### تعديل اشتراك (للمشرفين)

تعديل اشتراك موجود (للمشرفين فقط).

```
POST /api/subscriptions/{id}
```

#### المعلمات

| المعلمة | النوع | الوصف | المطلوب |
|---------|------|-------------|----------|
| start_date | date | تاريخ بدء الاشتراك | لا |
| end_date | date | تاريخ انتهاء الاشتراك | لا |
| amount_paid | numeric | المبلغ المدفوع | لا |
| status | string | حالة الاشتراك (active, expired, cancelled) | لا |
| notes | string | ملاحظات إضافية | لا |

#### الاستجابة

```json
{
    "status": "success",
    "message": "تم تحديث الاشتراك بنجاح",
    "data": {
        "id": 6,
        "user_id": 9,
        "service_id": 2,
        "start_date": "2023-08-10",
        "end_date": "2023-10-09",
        "amount_paid": "300.00",
        "status": "active",
        "notes": "تم تمديد الاشتراك لمدة شهر إضافي",
        "created_at": "2023-08-10T11:00:00.000000Z",
        "updated_at": "2023-08-10T11:30:00.000000Z",
        "service": {
            "id": 2,
            "name": "دعم فني شهري",
            "description": "خدمة دعم فني على مدار الشهر",
            "price": "150.00",
            "duration_days": 30,
            "is_active": true,
            "created_at": "2023-08-01T12:30:00.000000Z",
            "updated_at": "2023-08-01T12:30:00.000000Z"
        },
        "user": {
            "id": 9,
            "name": "فاطمة خالد",
            "email": "fatima@example.com",
            "role": "user",
            "phone": "0523456789",
            "is_active": true,
            "created_at": "2023-07-25T09:10:00.000000Z",
            "updated_at": "2023-07-25T09:10:00.000000Z"
        }
    }
}
```

### تجديد اشتراك (للمشرفين)

تجديد اشتراك موجود لفترة جديدة (للمشرفين فقط).

```
POST /api/subscriptions/{id}/renew
```

#### المعلمات

| المعلمة | النوع | الوصف | المطلوب |
|---------|------|-------------|----------|
| amount_paid | numeric | المبلغ المدفوع للتجديد | لا (الافتراضي: سعر الخدمة) |

#### الاستجابة

```json
{
    "status": "success",
    "message": "تم تجديد الاشتراك بنجاح",
    "data": {
        "id": 5,
        "user_id": 6,
        "service_id": 1,
        "start_date": "2023-08-15",
        "end_date": "2024-08-14",
        "amount_paid": "1000.00",
        "status": "active",
        "notes": "اشتراك مباشر من المستخدم. تم الدفع عبر التحويل البنكي",
        "created_at": "2023-08-06T08:30:00.000000Z",
        "updated_at": "2023-08-15T10:00:00.000000Z",
        "service": {
            "id": 1,
            "name": "صيانة سنوية",
            "description": "خدمة صيانة سنوية شاملة",
            "price": "1000.00",
            "duration_days": 365,
            "is_active": true,
            "created_at": "2023-08-01T12:00:00.000000Z",
            "updated_at": "2023-08-01T12:00:00.000000Z"
        },
        "user": {
            "id": 6,
            "name": "محمد أحمد",
            "email": "mohammed@example.com",
            "role": "user",
            "phone": "0512345678",
            "is_active": true,
            "created_at": "2023-07-18T11:20:00.000000Z",
            "updated_at": "2023-07-18T11:20:00.000000Z"
        }
    }
}
```